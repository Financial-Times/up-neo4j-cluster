#!/bin/bash
#CMD="imageservice-glb-ft-com-1325660098.eu-west-1.elb.amazonaws.com	ft-app-prod-2082341456.eu-west-1.elb.amazonaws.com	barrier-app-prod-euwest1-650885298.eu-west-1.elb.amazonaws.com	acc-licence-svc-euwest1-prod-2143380676.eu-west-1.elb.amazonaws.com	mashery-prod-api-gc-253043543.eu-west-1.elb.amazonaws.com	usr-product-svc-euwest1-prod-371591276.eu-west-1.elb.amazonaws.com	ft-memb-user-cred-svc-elb-1697013111.eu-west-1.elb.amazonaws.com	b2b-sign-up-app-euwest1-prod-566847432.eu-west-1.elb.amazonaws.com	edge-splunk-forwarder-euwest1-1616479247.eu-west-1.elb.amazonaws.com	zuora-event-bridge-euwest1-prod-1024702875.eu-west-1.elb.amazonaws.com	origamitesting-glb-ft-com-900763732.eu-west-1.elb.amazonaws.com	internal-invoice-svc-euwest1-prod-1560654570.eu-west-1.elb.amazonaws.com	licence-adm-app-euwest1-prod-1095183475.eu-west-1.elb.amazonaws.com	ft-app-api-uat-1847461202.eu-west-1.elb.amazonaws.com	concur-sess-svc-euwest1-prod-1269865336.eu-west-1.elb.amazonaws.com	licence-data-svc-euwest1-prod-779160208.eu-west-1.elb.amazonaws.com	redeem-token-svc-euwest1-prod-846487578.eu-west-1.elb.amazonaws.com	acq-context-svc-euwest1-prod-1896407923.eu-west-1.elb.amazonaws.com	pwm-189244709.eu-west-1.elb.amazonaws.com	internal-db-talend-prod-1493979567.eu-west-1.elb.amazonaws.com	internal-ft-app-prod-internal-864656335.eu-west-1.elb.amazonaws.com	healthcheck-1555470173.eu-west-1.elb.amazonaws.com	search-api-elasticsearch-eu-p-913904653.eu-west-1.elb.amazonaws.com	Konstructor-Version-API-1106404136.eu-west-1.elb.amazonaws.com	coreos-registry-93b603be-1169685577.eu-west-1.elb.amazonaws.com	internal-user-api-euwest1-prod-1251686964.eu-west-1.elb.amazonaws.com	ft-memb-user-cred-svc-at-elb-eu-946129326.eu-west-1.elb.amazonaws.com	subscription-api-public-elb-prod-1183667088.eu-west-1.elb.amazonaws.com	samlAuthenticatorLoadBalancer-1312729361.eu-west-1.elb.amazonaws.com	ft-memb-user-profile-svc-elb-p-2087370895.eu-west-1.elb.amazonaws.com	ft-memb-user-profile-svcat-elb-p-1838289058.eu-west-1.elb.amazonaws.com	amp-access-svc-euwest1-prod-1351761587.eu-west-1.elb.amazonaws.com	howsmyssl-euwest1-prod-342231350.eu-west-1.elb.amazonaws.com	fotoweb-prod-1060028996.eu-west-1.elb.amazonaws.com	ft-memb-session-api-at-elb-p-301208839.eu-west-1.elb.amazonaws.com	organizations-transformers-up-1480390797.eu-west-1.elb.amazonaws.com	FT-Alphaville-prod-ELB-163283667.eu-west-1.elb.amazonaws.com	brightcove-notifier-prod-up-1418296250.eu-west-1.elb.amazonaws.com	internal-sf-offers-bridge-euwest1-prod-1011859414.eu-west-1.elb.amazonaws.com	offer-api-euwest1-prod-698510007.eu-west-1.elb.amazonaws.com	kafka-httpbridge-euwest1-prod-276337966.eu-west-1.elb.amazonaws.com	ft-blogs-prod-elb-727133175.eu-west-1.elb.amazonaws.com	round-trippa-euwest-prod-446128806.eu-west-1.elb.amazonaws.com	awslatencytest-956965403.eu-west-1.elb.amazonaws.com	people-transformer-elb-123333108.eu-west-1.elb.amazonaws.com	membership-transformer-elb-1557020792.eu-west-1.elb.amazonaws.com	brands-transformer-elb-885654062.eu-west-1.elb.amazonaws.com	ft-memb-access-service-at-elb-eu-287296531.eu-west-1.elb.amazonaws.com	sign-up-app-euwest1-prod-779071874.eu-west-1.elb.amazonaws.com	internal-payment-mthd-svc-euwest1-prod-1094150824.eu-west-1.elb.amazonaws.com	myaccount-app-euwest1-prod-1357297727.eu-west-1.elb.amazonaws.com	coreos-up-1e0733a8-65261259.eu-west-1.elb.amazonaws.com	internal-zookeeper-prod-eu-west-elb-457985420.eu-west-1.elb.amazonaws.com	graphite-ireland-1591406825.eu-west-1.elb.amazonaws.com	coreos-up-f30e246f-1588112066.eu-west-1.elb.amazonaws.com	coreos-up-bb7b0b8d-2070299895.eu-west-1.elb.amazonaws.com	fotoweb-prod-a-1832562727.eu-west-1.elb.amazonaws.com	fotoweb-prod-b-2078436988.eu-west-1.elb.amazonaws.com	coreos-up-58d4a8f9-148014809.eu-west-1.elb.amazonaws.com	apigwateway-engine-elb-prod-1391481182.eu-west-1.elb.amazonaws.com	coreos-up-8d0cb13e-2018330835.eu-west-1.elb.amazonaws.com	coreos-up-087430ad-1320875643.eu-west-1.elb.amazonaws.com	coreos-up-4c0075a2-672092054.eu-west-1.elb.amazonaws.com	coreos-up-cc55fe69-224397763.eu-west-1.elb.amazonaws.com	user-details-svc-lb-euwest1-prod-665592845.eu-west-1.elb.amazonaws.com	subs-transition-svc-euwest1-prod-351543385.eu-west-1.elb.amazonaws.com	coreos-up-613d5b2f-719282531.eu-west-1.elb.amazonaws.com	coreos-up-1fcdc307-2112973874.eu-west-1.elb.amazonaws.com	internal-ADFS-52104841.eu-west-1.elb.amazonaws.com	a495f135a948111e6bc9006022981898-420817362.eu-west-1.elb.amazonaws.com	a4be9cd6d948111e6bc9006022981898-1809963317.eu-west-1.elb.amazonaws.com	internal-rr-recommendation-api-prod-2-1022403952.eu-west-1.elb.amazonaws.com	fastly-splunk-hec-1442989214.eu-west-1.elb.amazonaws.com	customer-sso-elb-prod-euwest1-350737221.eu-west-1.elb.amazonaws.com	internal-nwspr-fulfil-svc-euwest1-prod-409056342.eu-west-1.elb.amazonaws.com	mash-test-glb-uk-2128705981.eu-west-1.elb.amazonaws.com	coreos-up-0075fa17-236176115.eu-west-1.elb.amazonaws.com	nexuslb2-1016108866.eu-west-1.elb.amazonaws.com	internal-subs-history-svc-elb-prod-1903850631.eu-west-1.elb.amazonaws.com	nexuslb7-245471647.eu-west-1.elb.amazonaws.com	mashery-prod-api-temp-1696505176.eu-west-1.elb.amazonaws.com	grafana-ireland-860457205.eu-west-1.elb.amazonaws.com	internal-jussi-neo4-20161215-L-neo1-ELB-323091022.eu-west-1.elb.amazonaws.com	internal-jussi-neo4-20161215-L-neo3-ELB-84193354.eu-west-1.elb.amazonaws.com	internal-jussi-neo4-20161215-L-neo2-ELB-955693829.eu-west-1.elb.amazonaws.com"

source $(dirname $0)/functions.sh || echo "Failed to source functions"

declare -a ELBS
STACKNAME=$(getStackName)

time for each in $(aws elb --region eu-west-1 describe-load-balancers --output text --query LoadBalancerDescriptions[].DNSName); do
#time for each in $(echo $CMD); do
  if [[ "$(echo $each | grep -i "${STACKNAME}" > /dev/null; echo $?)" == "0" ]]; then
    info append
    ELBS+=( "$each" )
  fi
done

if [[ "${#ELBS[*]}" -eq "0" ]]; then #If number of records is 0 fail visibly
  errorAndExit "Failed to find any ELB records for stack named ${STACKNAME}" 1
else
  info "Number of records ${#ELBS[*]}: ${ELBS[*]}"
fi
